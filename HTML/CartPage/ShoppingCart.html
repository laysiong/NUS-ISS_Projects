<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Shopping Cart</title>
    <link href="css/stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
    <!-- The page should contain features such as header, menu, cart items with images.
        Should have buttons for Add to cart, Remove from cart, Check out etc.
        While adding functionality is optional, learners may do well to refer to
        some standard shopping card JavaScript code abundantly available over the internet
        to understand the programming elements associated with the such web based application
        (to be taught as part of the main course) deliverables for this assignment are HTML
        and CSS source files. -->
    <!-- Class is used for multiple elements which have common attributes. -->
    <!--  Id on the other hand is used for highlighting a single element
          attributes and used exclusively for a particular element only. -->

    <div class="header">
        <div class="topMenu">
            <div>
                <span><b>Tooglota</b></span> 
            </div>
            <div class="myaccountMenu">
                <span><a href="#">My Account</a></span>
                <span><a href="#" >Create Account</a></span>
            </div>
        </div>
        <div class="webBanner">

            <img src="img/Web_Banner.png"/>
        </div>

        <div class="nagivatorMenu">
            <div>
                <span><a href="#">Products</a></span>
                <span><a href="#">News</a></span>
                <span><a href="#">About Us</a></span>
                <span><a href="#">FAQ</a></span>
            </div>
        </div>


        <div class="pageTitleHeader">
            <div class="pageTitle"><h1>Cart</h1></div>
            <div class="icon-span">
                <a href='#'><img src="img/shopping-cart.png" /></a>
                <span>0</span>
            </div>
        </div>
    </div>

    <div class="middle">
        <div class="product_display">

            <div class="itemlist" data-id="1">
                <div class="image"><img src="img/VR_headset.png" width="150" /></div>
                <div class="name"><b>VR Sens Conet Googles</b></div>
                <div class="price">$500.00</div>
                <div class="quantity">
                    <span class="addCart"> + </span>
                    <span class="numOfItem"><input type="number" class="quantityItem" width="48" value="1" min="0" max="99" /></span>
                    <span class="minus"> - </span>
                </div>
                <div class="itemRemove">
                    <span><img class="remove" src="img/cancel.png" /></span>
                </div>
            </div>
            <div class="itemlist" data-id="2">
                <div class="image"><img src="img/VR_headset2.png" width="150" /></div>
                <div class="name"><b>VR Omnisense Googles</b></div>
                <div class="price">$250.00</div>
                <div class="quantity">
                    <span class="addCart"> + </span>
                    <span class="numOfItem"><input type="number" class="quantityItem" width="48" value="1" min="0" max="99" /></span>
                    <span class="minus"> - </span>
                </div>
                <div class="itemRemove">
                    <span ><img class="remove" src="img/cancel.png"/></span>
                </div>
            </div>

        </div>

        <div class="cartCheckOut">
            <div class="cartCoupon">
                <span>COUPON</span>
                <span>Enter your coupon code if you have one.</span>
                <span class="couponInput"><input class="userInput" type="text"/> <input type="button" class="applyCoupon" value="APPLY COUPON"></span>
            </div>

            <div class="cartTotal">
                <div class="cartSubtotal">
                    <div class="subtotal">
                        <span>SUBTOTAL</span>
                        <span class="totalprice">$0.00</span>
                    </div>
                    <div class="shipping">
                        <span>Shipping</span>
                        <span>
                            <span><input type="radio" name="shippingfee" value="1" checked/> Flat Rate: $7.00</span>
                            <span><input type="radio" name="shippingfee" value="0" /> Free Shipping</span>
                        </span>
                    </div>
                    <div class="typeofCoupon">
                    
                    </div>
                    <div>
                        <span><h1>Total</h1></span>
                        <span class="finalprice"><h1>$0.00</h1></span>
                    </div>
                </div>

                <div class="btn">
                    <input type="submit" class="buttonCheckOut" value="Proceed to Checkout" />
                </div>

            </div>
        </div>

    </div>


    <div class="footer">© 2024 Eithan Toh @ The Forge</div>
    <script type="text/javascript">

        //checkout button
        const element = document.querySelector(".buttonCheckOut");
        element.addEventListener("click", checkOutFunction);

        //Adding and Removing from Cart
        let iconCartSpan = document.querySelector('.icon-span span');
        let listProductsHTML = document.querySelector('.product_display');


        let listProducts = [
            {
                product_id: 1,
                name: "VR Sens Conet Googles",
                image: "img/VR_headset.png",
                price: 500.00
            },
            {
                product_id: 2,
                name: "VR Sens Conet Googles",
                image: "img/VR_headset2.png",
                price: 250.00
            },
        ];

        let carts = [];

        //Total
        let SubTotal = document.querySelector('.subtotal')

        //Coupon Query
        const applyCoupon = document.querySelector(".applyCoupon");
        applyCoupon.addEventListener("click", applycouponFunc);
        let validcoupon = ["20%coupon","50%coupon"];

        listProductsHTML.addEventListener('click', getProductID);

        /*------------------------ CART ---------------------------*/
        // create cart table (product_id and quantity)
        function getProductID(event) {
            let positionClick = event.target;
            //alert(positionClick);
            if (positionClick.classList.contains('addCart') || positionClick.classList.contains('minus') || positionClick.classList.contains('remove') ) {
                let product_id = positionClick.parentElement.parentElement.dataset.id;
                let product_quantity = getProductQuantity(positionClick);

                let type = 'addItem'
                if (positionClick.classList.contains('minus')) {
                    type = 'minusItem';
                } else if (positionClick.classList.contains('remove')) {
                    type = 'removeItem';
                }
                addToCart(product_id, type, product_quantity);
            }
        }

        function getProductQuantity(event) {
            if (event.classList.contains('addCart') || event.classList.contains('minus'))
            {
                let product_quantity = parseInt(event.parentElement.querySelector('.quantityItem').value);
                return product_quantity;
            }
        }

        function addToCart(product_id, type, product_quantity) {

            //switch have to happen first.

            let productIDinCart = carts.findIndex((value) => value.product_id == product_id);

            switch (type) {

                case 'minusItem':
                    let valueChange = carts[productIDinCart].quantity - product_quantity;
                    //alert(valueChange);
                    if (valueChange > 0) {
                        carts[productIDinCart].quantity = valueChange;
                    } else {
                        carts.splice(productIDinCart, 1);
                    }
                    break;

                case 'removeItem':
                    //alert("remove");
                    carts.splice(productIDinCart, 1);
                    break;

                default:

                    if (carts.length <= 0) {
                        carts = [{
                            product_id: product_id,
                            quantity: product_quantity
                        }];
                    } else if (productIDinCart < 0) {
                        carts.push({
                            product_id: product_id,
                            quantity: product_quantity
                        });
                    } else {
                        carts[productIDinCart].quantity = carts[productIDinCart].quantity + product_quantity;
                    }
                    break;

            }

            //console.log(product_id);
            updatetotalPrice(product_id);
            updateCartToHTML();
        }

        function updateCartToHTML() {


            let totalQuantity = 0;
            carts.forEach(carts => {
                totalQuantity = totalQuantity + carts.quantity;

            })
            //totalQuantity = carts.length;

            //return to update span in HTML content
            iconCartSpan.innerText = totalQuantity;
            countTotal();

        }


        let baseCost = 0;
        let shippingfee = 7;
        let shippingIncluded = true;
        let discout = 0;
        applycouponFunc();

        /*------------------------ CHECK COUPON ---------------------------*/
        function applycouponFunc() {
            let couponInput = document.querySelector(".userInput");
            let typeCoupon = document.querySelector(".typeofCoupon");

            //let status = 'not valid';
            let couponName = "<span> Coupon Applied </span> <span>" + "None" + "</span>";
            discout = 0;

            validcoupon.forEach(validcoupon => {

                //console.log(validcoupon);
                console.log(couponInput.value);
                if (validcoupon == couponInput.value) {
                    switch (couponInput.value) {
                        case "20%coupon":
                            discout = 0.2;
                            couponName = "<span><b> Coupon Applied </b></span> <span><b>" + "20% Discounted" + "</b></span>"
                            break;
                        case "50%coupon":
                            discout = 0.5;
                            couponName = "<span><b> Coupon Applied </b></span> <span><b>" + "50% Discounted" + "</b></span>"
                            break;
                        default:
                            couponName = "<span> Coupon Applied </span> <span>" + "None" + "</span>"
                            discout = 0;
                    }
                    //status = "valid";
                } 
            })  

            typeCoupon.innerHTML = couponName;
            countTotal();
            //alert(status);
        }

   

        /*------------------------ UPDATE PRICES ---------------------------*/
        function updatetotalPrice(product_id) {
            let totalPrice = 0;

            carts.forEach(carts => {
                let positionProduct = listProducts.findIndex((value) => value.product_id == carts.product_id);
                let info = listProducts[positionProduct];


                totalPrice = totalPrice + (info.price * carts.quantity);

            })
            //console.log(totalPrice);
            baseCost = totalPrice;
            SubTotal.querySelector('.totalprice').innerHTML = "$" + totalPrice.toFixed(2);
            //console.log(carts);
        }

        //shipping fee
        //OnClick will trigger multiple time, need to use 'change' instead.
        document.querySelectorAll('.shipping span span input[name=shippingfee]').forEach(radio => {
                radio.addEventListener('change', function () {
                    if (this.checked) {
                        console.log(this.value + " is selected");

                        if (this.value == 1) {
                            shippingfee = 7;
                        } else {
                            shippingfee = 0;
                        }    
                        countTotal();
                    }
                });
        });   


        /*------------------------ TOTAL AMOUNT ---------------------------*/
        function countTotal() {
            var totalAmount = (baseCost * (1 - discout)) + shippingfee;
            var countTotal = document.querySelector('.cartSubtotal div .finalprice');
            countTotal.innerHTML = "<h1> $" + totalAmount.toFixed(2) +"</h1>";
        }
        


        function checkOutFunction() {
            alert('check out');
        }

    </script>


</body>
</html>
